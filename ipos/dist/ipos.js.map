{"version":3,"file":"ipos.js","sources":["../src/loader.js","../src/params.js","../src/utils.js","../src/index.js"],"sourcesContent":["export const loaded = {};\r\n\r\nexport const needsLoad = src => !loaded[src];\r\n\r\nexport const load = (src, {\r\n  module = false,\r\n  target = document.querySelector('body')\r\n}) => new Promise((resolve, reject) => {\r\n  const script = document.createElement('script');\r\n  if (module) script.setAttribute('type', 'module');\r\n  script.onload = () => {\r\n    loaded[src] = true;\r\n    resolve();\r\n  };\r\n  script.onerror = error => reject(error);\r\n  script.src = src;\r\n  target.appendChild(script);\r\n});\r\n\r\nexport default src => load(src);\r\n","export const packageLocation = 'packages';\r\n\r\nexport const appLocation = 'apps';\r\n\r\nexport const startupPath = 'startup';\r\n","import { startupPath } from './params';\r\n\r\nexport const join = paths => paths.reduce((p, c) => { p += `/${c}`}, '');\r\n\r\nexport const read = path => api.files.get(path);\r\n\r\nexport const startup = new Promise(async (resolve, reject) => {\r\n  await read(join(startupPath, 'index'));\r\n});\r\n","import load from './loader';\r\nimport { appLocation } from './params';\r\nimport { startup, join } from './utils';\r\n\r\n/**\r\n * Load basic os dependencies\r\n *\r\n * @param {object} flags Enable/disable features/experimental-features\r\n * @param {boolean} flags.rescueMode Boot into os disabling everything except os packages\r\n * @return Promise\r\n */\r\nconst loadOS = flags => new Promise(async (resolve, reject) => {\r\n  const packages = ['desktop', 'clock', 'launcher'].map(name => join([packageLocation, name]))\r\n  // load app that are defined in startup\r\n  const apps = startup.map(name => join([appLocation, name]));\r\n  \r\n  try {\r\n    await load(packages);\r\n    // TODO: should launcher load apps?\r\n    await load(apps);\r\n    resolve(); // everything loaded\r\n  } catch (e) {\r\n    reject(e);\r\n  }\r\n});\r\n\r\n\r\nexport default loadOS()\r\n"],"names":["loaded","load","src","document","querySelector","Promise","resolve","reject","script","createElement","module","setAttribute","onload","onerror","error","appendChild","appLocation","startupPath","join","paths","reduce","p","c","read","path","api","files","get","startup","loadOS","flags","packages","map","name","packageLocation","apps","e"],"mappings":";;;AAAO,MAAMA,SAAS,EAAf;AAEP,AAAO;AAEP,AAAO,MAAMC,OAAO,CAACC,GAAD,EAAM;WACf,KADe;WAEfC,SAASC,aAAT,CAAuB,MAAvB;CAFS,KAGd,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;QAC/BC,SAASL,SAASM,aAAT,CAAuB,QAAvB,CAAf;MACIC,MAAJ,EAAYF,OAAOG,YAAP,CAAoB,MAApB,EAA4B,QAA5B;SACLC,MAAP,GAAgB,MAAM;WACbV,GAAP,IAAc,IAAd;;GADF;SAIOW,OAAP,GAAiBC,SAASP,OAAOO,KAAP,CAA1B;SACOZ,GAAP,GAAaA,GAAb;SACOa,WAAP,CAAmBP,MAAnB;CATI,CAHC;AAeP,cAAeN,OAAOD,KAAKC,GAAL,CAAtB;;ACjBO,MAAMc,cAAc,MAApB;AAEP,AAAO,MAAMC,cAAc,SAApB;;ACFA,MAAMC,OAAOC,SAASA,MAAMC,MAAN,CAAa,CAACC,CAAD,EAAIC,CAAJ,KAAU;OAAQ,IAAGA,CAAE,EAAX;CAAzB,EAAwC,EAAxC,CAAtB;AAEP,AAAO,MAAMC,OAAOC,QAAQC,IAAIC,KAAJ,CAAUC,GAAV,CAAcH,IAAd,CAArB;AAEP,AAAO,MAAMI,UAAU,IAAIvB,OAAJ,CAAY,OAAOC,OAAP,EAAgBC,MAAhB,KAA2B;QACtDgB,KAAKL,KAAKD,WAAL,EAAkB,OAAlB,CAAL,CAAN;CADqB,CAAhB;;ACKP,MAAMY,SAASC,SAAS,IAAIzB,OAAJ,CAAY,OAAOC,OAAP,EAAgBC,MAAhB,KAA2B;QACvDwB,WAAW,CAAC,SAAD,EAAY,OAAZ,EAAqB,UAArB,EAAiCC,GAAjC,CAAqCC,QAAQf,KAAK,CAACgB,eAAD,EAAkBD,IAAlB,CAAL,CAA7C,CAAjB;QAEME,OAAOP,QAAQI,GAAR,CAAYC,QAAQf,KAAK,CAACF,WAAD,EAAciB,IAAd,CAAL,CAApB,CAAb;MAEI;UACIhC,OAAK8B,QAAL,CAAN;UAEM9B,OAAKkC,IAAL,CAAN;cAHE;GAAJ,CAKE,OAAOC,CAAP,EAAU;WACHA,CAAP;;CAXoB,CAAxB;AAgBA,YAAeP,QAAf;;;;"}